<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Measure Data Logger ‚Äì Dashboard</title>

<!-- Librer√≠as -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- Para gr√°ficas interactivas de pron√≥sticos -->
<script src="https://cdn.jsdelivr.net/npm/luxon@3.0.0/build/global/luxon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.1.0/dist/chartjs-adapter-luxon.min.js"></script>

<style>
:root{
  --ucc-azul:#003366;
  --ucc-verde:#7AC043;
  --gris:#F2F2F2;
  --text:#0b1220;
}

/* Base */
body{font-family:Inter,Arial,Helvetica,sans-serif;margin:0;background:var(--gris);color:var(--text);transition:0.3s}
header{background:var(--ucc-azul);color:#fff;padding:16px 20px;display:flex;align-items:center;justify-content:space-between}
.header-title{font-weight:700;letter-spacing:.6px}
.header-actions{display:flex;gap:10px;align-items:center}

/* Buttons */
.btn{background:var(--ucc-verde);border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
.btn.secondary{background:#ffffff;color:var(--ucc-azul);border:1px solid rgba(0,0,0,0.06)}
.icon-btn{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff;padding:6px 8px;border-radius:8px;cursor:pointer}

/* Container */
.container{max-width:1200px;margin:22px auto;padding:0 16px}

/* KPI Cards row */
.kpi-row{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:18px}
.kpi-card{background:#fff;border-radius:10px;padding:16px;box-shadow:0 6px 18px rgba(11,18,32,0.06);display:flex;align-items:center;gap:12px}
.kpi-icon{width:56px;height:56px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--ucc-azul),#0a2b5a);color:#fff}
.kpi-body{flex:1}
.kpi-title{font-size:13px;color:#334155;margin:0 0 6px 0}
.kpi-value{font-size:22px;font-weight:700;color:var(--ucc-azul)}
.kpi-meta{font-size:12px;color:#6b7280;margin-top:6px}

/* Middle: charts + controls */
.charts-panel{display:grid;grid-template-columns:1fr;gap:16px;margin-bottom:18px}
.controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:8px}

/* Chart containers */
.chart-container{background:#fff;border-radius:12px;padding:18px;box-shadow:0 6px 18px rgba(11,18,32,0.06)}
.chart-title{font-size:16px;font-weight:600;color:var(--ucc-azul);margin:0 0 12px 0}
.chart-wrapper{position:relative;height:400px;width:100%}

/* Legend */
.legend-container{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px;padding-top:12px;border-top:1px solid #eee}
.legend-item{display:flex;align-items:center;gap:6px;font-size:12px}
.legend-color{width:12px;height:12px;border-radius:50%}

/* Responsive */
@media (max-width:768px){
  .kpi-row{grid-template-columns:1fr}
  .chart-wrapper{height:300px}
}
</style>
</head>
<body>
<header>
  <h1 class="header-title">Measure Data Logger ‚Äì Dashboard</h1>
  <div class="header-actions">
    <button class="icon-btn">üì•</button>
    <button class="icon-btn">‚öôÔ∏è</button>
    <button class="btn">Exportar</button>
  </div>
</header>

<div class="container">
  <!-- KPI Cards -->
  <div class="kpi-row">
    <div class="kpi-card">
      <div class="kpi-icon">üìä</div>
      <div class="kpi-body">
        <h3 class="kpi-title">Medici√≥n Actual PM 2.5</h3>
        <div class="kpi-value">0.0 ¬µg/m¬≥</div>
        <div class="kpi-meta">√öltima actualizaci√≥n: 26 Nov</div>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">üîÆ</div>
      <div class="kpi-body">
        <h3 class="kpi-title">Pron√≥stico PM 2.5</h3>
        <div class="kpi-value">0.0 ¬µg/m¬≥</div>
        <div class="kpi-meta">Pr√≥xima medici√≥n</div>
      </div>
    </div>
    <div class="kpi-card">
      <div class="kpi-icon">‚ö†Ô∏è</div>
      <div class="kpi-body">
        <h3 class="kpi-title">Nivel M√°ximo Permitido</h3>
        <div class="kpi-value">37.0 ¬µg/m¬≥</div>
        <div class="kpi-meta">24H en Colombia</div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="charts-panel">
    <div class="controls">
      <button class="btn">PM 2.5</button>
      <button class="btn secondary">PM 10</button>
      <button class="btn secondary">NO‚ÇÇ</button>
      <button class="btn secondary">O‚ÇÉ</button>
      <select class="btn secondary">
        <option>√öltimos 10 d√≠as</option>
        <option>√öltimos 30 d√≠as</option>
      </select>
    </div>

    <!-- Main Chart -->
    <div class="chart-container">
      <h2 class="chart-title">Pron√≥stico de PM 2.5 con Bandas de Confianza</h2>
      <div class="chart-wrapper">
        <canvas id="forecastChart"></canvas>
      </div>
      <div class="legend-container" id="chartLegend"></div>
    </div>
  </div>
</div>

<script>
// Datos extra√≠dos de la tabla proporcionada
const forecastData = {
  dates: ['10 Nov', '12 Nov', '14 Nov', '16 Nov', '18 Nov', '20 Nov', '22 Nov', '24 Nov', '26 Nov'],
  measured: [0.0, 6.0, -4.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  forecast: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  confidence80Upper: [0.0, 0.0, 0.0, 0.2, 0.0, 0.0, 0.0, 0.0, 0.0],
  confidence80Lower: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  confidence95Upper: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  confidence95Lower: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  maxAllowed: [0.1, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0]
};

// Colores para las bandas y l√≠neas
const colors = {
  measured: '#003366',        // Azul UCC para mediciones reales
  forecast: '#7AC043',        // Verde UCC para pron√≥stico
  confidence80: 'rgba(122, 192, 67, 0.2)',  // Verde claro para confianza 80%
  confidence95: 'rgba(122, 192, 67, 0.1)',  // Verde m√°s claro para confianza 95%
  maxAllowed: '#FF6B6B',      // Rojo para l√≠mite m√°ximo
  grid: 'rgba(0, 0, 0, 0.05)'
};

// Funci√≥n para crear la gr√°fica
function createForecastChart() {
  const ctx = document.getElementById('forecastChart').getContext('2d');
  
  // Configuraci√≥n de la gr√°fica
  const chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: forecastData.dates,
      datasets: [
        // Banda de confianza del 95%
        {
          label: 'Confianza 95%',
          data: forecastData.confidence95Upper,
          backgroundColor: colors.confidence95,
          borderWidth: 0,
          fill: '+1', // Rellenar hasta el siguiente dataset (confidence95Lower)
          pointRadius: 0,
          tension: 0.3
        },
        {
          label: '',
          data: forecastData.confidence95Lower,
          backgroundColor: colors.confidence95,
          borderWidth: 0,
          fill: '-1', // Rellenar hasta el dataset anterior (confidence95Upper)
          pointRadius: 0,
          tension: 0.3
        },
        
        // Banda de confianza del 80%
        {
          label: 'Confianza 80%',
          data: forecastData.confidence80Upper,
          backgroundColor: colors.confidence80,
          borderWidth: 0,
          fill: '+1', // Rellenar hasta el siguiente dataset (confidence80Lower)
          pointRadius: 0,
          tension: 0.3
        },
        {
          label: '',
          data: forecastData.confidence80Lower,
          backgroundColor: colors.confidence80,
          borderWidth: 0,
          fill: '-1', // Rellenar hasta el dataset anterior (confidence80Upper)
          pointRadius: 0,
          tension: 0.3
        },
        
        // L√≠nea de pron√≥stico
        {
          label: 'Pron√≥stico PM 2.5',
          data: forecastData.forecast,
          borderColor: colors.forecast,
          backgroundColor: 'transparent',
          borderWidth: 3,
          pointRadius: 4,
          pointBackgroundColor: colors.forecast,
          tension: 0.3
        },
        
        // L√≠nea de mediciones reales
        {
          label: 'Medido PM 2.5',
          data: forecastData.measured,
          borderColor: colors.measured,
          backgroundColor: 'transparent',
          borderWidth: 3,
          pointRadius: 4,
          pointBackgroundColor: colors.measured,
          borderDash: [5, 5],
          tension: 0.3
        },
        
        // L√≠nea de nivel m√°ximo permitido
        {
          label: 'Nivel m√°ximo permitido (24H)',
          data: forecastData.maxAllowed,
          borderColor: colors.maxAllowed,
          backgroundColor: 'transparent',
          borderWidth: 2,
          pointRadius: 0,
          borderDash: [10, 5],
          tension: 0
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false // Ocultamos la leyenda por defecto, crearemos una personalizada
        },
        tooltip: {
          mode: 'index',
          intersect: false,
          callbacks: {
            label: function(context) {
              let label = context.dataset.label || '';
              if (label) {
                label += ': ';
              }
              label += context.parsed.y.toFixed(1) + ' ¬µg/m¬≥';
              return label;
            }
          }
        }
      },
      scales: {
        x: {
          grid: {
            color: colors.grid
          },
          title: {
            display: true,
            text: 'Fecha',
            font: {
              weight: 'bold'
            }
          }
        },
        y: {
          beginAtZero: true,
          grid: {
            color: colors.grid
          },
          title: {
            display: true,
            text: 'Concentraci√≥n (¬µg/m¬≥)',
            font: {
              weight: 'bold'
            }
          }
        }
      }
    }
  });
  
  // Crear leyenda personalizada
  createLegend();
  
  return chart;
}

// Funci√≥n para crear la leyenda personalizada
function createLegend() {
  const legendContainer = document.getElementById('chartLegend');
  const legendItems = [
    { label: 'Medido PM 2.5', color: colors.measured, dashed: true },
    { label: 'Pron√≥stico PM 2.5', color: colors.forecast, dashed: false },
    { label: 'Confianza 80%', color: colors.confidence80, dashed: false },
    { label: 'Confianza 95%', color: colors.confidence95, dashed: false },
    { label: 'Nivel m√°ximo permitido (24H)', color: colors.maxAllowed, dashed: true }
  ];
  
  legendItems.forEach(item => {
    const legendItem = document.createElement('div');
    legendItem.className = 'legend-item';
    
    const colorBox = document.createElement('div');
    colorBox.className = 'legend-color';
    colorBox.style.backgroundColor = item.color;
    if (item.dashed) {
      colorBox.style.backgroundImage = 'linear-gradient(45deg, transparent 45%, #ccc 45%, #ccc 55%, transparent 55%)';
    }
    
    const labelText = document.createElement('span');
    labelText.textContent = item.label;
    
    legendItem.appendChild(colorBox);
    legendItem.appendChild(labelText);
    legendContainer.appendChild(legendItem);
  });
}

// Inicializar la gr√°fica cuando el DOM est√© listo
document.addEventListener('DOMContentLoaded', function() {
  createForecastChart();
  
  // Actualizar el KPI con el √∫ltimo valor medido
  const lastMeasured = forecastData.measured[forecastData.measured.length - 1];
  document.querySelector('.kpi-card:nth-child(1) .kpi-value').textContent = 
    lastMeasured.toFixed(1) + ' ¬µg/m¬≥';
  
  // Actualizar el KPI con el √∫ltimo pron√≥stico
  const lastForecast = forecastData.forecast[forecastData.forecast.length - 1];
  document.querySelector('.kpi-card:nth-child(2) .kpi-value').textContent = 
    lastForecast.toFixed(1) + ' ¬µg/m¬≥';
});
</script>
</body>
</html>

name:  Ejecutar SARIMA Autom谩tico

on:
  schedule:
    - cron: '0 */12 * * *'
  workflow_dispatch:

#  AADE ESTOS PERMISOS GLOBALES
permissions:
  contents: write  # Permite escribir (commit/push) en el repositorio
  pages: write     # Si usas GitHub Pages
  actions: read    # Para ver otras acciones

jobs:
  ejecutar-sarima:
    runs-on: ubuntu-latest
    
    #  AADE TAMBIN PERMISOS A NIVEL DE JOB
    permissions:
      contents: write  # Sobrescribe permisos para este job espec铆fico
    
    steps:
    # 1.  Descargar el c贸digo
    - name: Descargar c贸digo
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
        #  IMPORTANTE: Configurar token
        token: ${{ secrets.GITHUB_TOKEN }}
    
    # 2.  Instalar Python
    - name: Instalar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    # 3.  Instalar programas necesarios
    - name: Instalar dependencias
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    # 4.  Ejecutar tu c贸digo (generar谩 los archivos)
    - name: Ejecutar modelo SARIMA
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        GOOGLE_SHEETS_CREDS: ${{ secrets.GOOGLE_SHEETS_CREDS }}
      run: |
        echo " Iniciando modelo SARIMA..."
        python modelo_sarima.py
    
    # 5.  Subir archivos generados (NUEVO PASO)
    - name: Subir archivos generados
      run: |
        echo " Subiendo archivos generados..."
        
        # Configurar git
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        # Agregar todos los archivos nuevos
        git add *.json *.csv pronosticos/ || true
        
        # Verificar si hay cambios
        if git diff --cached --quiet; then
          echo "锔 No hay cambios para subir"
        else
          echo " Guardando cambios..."
          git commit -m " Actualizaci贸n autom谩tica $(date +'%Y-%m-%d %H:%M')"
          
          echo " Subiendo cambios..."
          git push origin HEAD:main
        fi
